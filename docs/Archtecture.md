–í–æ—Ç **—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã **¬´–•–æ–ª—Å—Ç¬ª** ‚Äî –ø–æ–ª–Ω–∞—è, —Å–ª–æ–∏—Å—Ç–∞—è, —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –ø–æ—Ç–æ–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

---

## üèóÔ∏è **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã ¬´–•–æ–ª—Å—Ç¬ª**

### **–û–±—â–∞—è —Å—Ö–µ–º–∞ (high-level)**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –±—Ä–∞—É–∑–µ—Ä                    ‚îÇ
‚îÇ  (Desktop / Mobile)                                                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ                                           ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   Frontend    ‚îÇ                         ‚îÇ    Voice STT       ‚îÇ
        ‚îÇ  (Vue 3 +     ‚îÇ                         ‚îÇ   (Vosk API)       ‚îÇ
        ‚îÇ   Konva.js)   ‚îÇ                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                   ‚îÇ (–∞—É–¥–∏–æ ‚Üí —Ç–µ–∫—Å—Ç)
                ‚îÇ                                           ‚îÇ
                ‚îÇ (HTTP / WebSocket)                        ‚îÇ
                ‚ñº                                           ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                        Nginx (Reverse Proxy)                  ‚îÇ
        ‚îÇ  - –û—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏–∫—É (frontend)                                 ‚îÇ
        ‚îÇ  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç /api/ ‚Üí backend                                ‚îÇ
        ‚îÇ  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç /voice/ ‚Üí voice-stt                            ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ            Backend                  ‚îÇ
                   ‚îÇ  (FastAPI + Gunicorn)               ‚îÇ
                   ‚îÇ                                     ‚îÇ
                   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
                   ‚îÇ  ‚îÇ  API Layer  ‚îÇ  ‚îÇ  Services    ‚îÇ ‚îÇ
                   ‚îÇ  ‚îÇ (routers)   ‚îÇ  ‚îÇ - Search     ‚îÇ ‚îÇ
                   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ - Export     ‚îÇ ‚îÇ
                   ‚îÇ         ‚îÇ         ‚îÇ - CycleCheck ‚îÇ ‚îÇ
                   ‚îÇ         ‚ñº         ‚îÇ - VoiceProxy ‚îÇ ‚îÇ
                   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
                   ‚îÇ  ‚îÇ  Business   ‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îÇ  Logic      ‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îÇ (CRUD,      ‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îÇ  validation)‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
                   ‚îÇ         ‚îÇ                          ‚îÇ
                   ‚îÇ         ‚ñº                          ‚îÇ
                   ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
                   ‚îÇ  ‚îÇ   Data      ‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îÇ  Access     ‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îÇ (SQLAlchemy)‚îÇ                   ‚îÇ
                   ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                             ‚îÇ
                             ‚ñº
                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ     PostgreSQL        ‚îÇ
                   ‚îÇ  - cards              ‚îÇ
                   ‚îÇ  - notes              ‚îÇ
                   ‚îÇ  - files              ‚îÇ
                   ‚îÇ  - task_links         ‚îÇ
                   ‚îÇ  - note_links         ‚îÇ
                   ‚îÇ  - event_log          ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

                   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                   ‚îÇ      File Storage     ‚îÇ
                   ‚îÇ  (Docker volume:      ‚îÇ
                   ‚îÇ   /data/uploads/)     ‚îÇ
                   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç **–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**

### **1. Frontend (–ö–ª–∏–µ–Ω—Ç)**
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: Vue 3 + Pinia (state management)
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–ª–æ–∫–∞–ª—å–Ω–æ)**:
  - `Konva.js` ‚Äî –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ö–æ–ª—Å—Ç, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞—Ä—Ç–æ—á–µ–∫.
  - `Tiptap` ‚Äî WYSIWYG-—Ä–µ–¥–∞–∫—Ç–æ—Ä (—Ç–µ–∫—Å—Ç, —Ç–∞–±–ª–∏—Ü—ã, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è).
  - `Cytoscape.js` ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞ —Å–≤—è–∑–µ–π.
  - `interact.js` ‚Äî touch/mouse drag –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö.
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ö–æ–ª—Å—Ç–∞ –∏ –≥—Ä–∞—Ñ–∞.
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (—Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ/—Å–≤—ë—Ä–Ω—É—Ç–æ).
  - –õ–æ–∫–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏.
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API.
  - –ó–∞—Ö–≤–∞—Ç –∞—É–¥–∏–æ ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ `/voice/transcribe`.

---

### **2. Nginx (Reverse Proxy)**
- **–†–æ–ª–∏**:
  - –û—Ç–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`index.html`, `js`, `css`).
  - –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç:
    - `/api/*` ‚Üí `backend:8000`
    - `/voice/*` ‚Üí `voice-stt:3000`
  - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç HTTPS (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–∏).
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**:
  - –ù–µ –æ—Ç–¥–∞—ë—Ç –Ω–∞–ø—Ä—è–º—É—é `/uploads/` ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ backend.

---

### **3. Backend (FastAPI + Gunicorn)**
#### **–°–ª–æ–∏**:
- **API Layer** (`/app/routers/`):
  - REST-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫, –∑–∞–º–µ—Ç–æ–∫, —Å–≤—è–∑–µ–π, —Ñ–∞–π–ª–æ–≤, –ø–æ–∏—Å–∫–∞ –∏ —Ç.–¥.
- **Services Layer** (`/app/services/`):
  - `search_service.py` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–ø—Ä–æ—Å—ã full-text search.
  - `export_service.py` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF/Markdown.
  - `cycle_detection.py` ‚Äî DFS-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ü–∏–∫–ª–∏–≤–∞–Ω–∏—è –ø—Ä–∏ —Å–≤—è–∑—ã–≤–∞–Ω–∏–∏ –∑–∞–¥–∞—á.
  - `voice_proxy.py` ‚Äî –ø–µ—Ä–µ—Å—ã–ª–∫–∞ –∞—É–¥–∏–æ –≤ Vosk –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ç–µ–∫—Å—Ç–∞.
- **Business Logic**:
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏.
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ `event_log`.
- **Data Access**:
  - SQLAlchemy ORM + —Å–µ—Å—Å–∏–∏.
  - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

---

### **4. Voice STT (Vosk)**
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä**: –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –Ω–∞ Python + Vosk.
- **–ú–æ–¥–µ–ª—å**: `vosk-model-small-ru-0.22` (—Ä—É—Å—Å–∫–∏–π, ~50 –ú–ë).
- **API**:
  ```http
  POST /transcribe
  Content-Type: audio/wav
  ‚Üí –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON: { "text": "–ø—Ä–∏–≤–µ—Ç –∫–∞–∫ –¥–µ–ª–∞" }
  ```
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: backend –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∞—É–¥–∏–æ –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ ‚Üí Vosk ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç.

---

### **5. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)**
#### **–¢–∞–±–ª–∏—Ü—ã**:
| –¢–∞–±–ª–∏—Ü–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|-----------|
| `cards` | –ó–∞–¥–∞—á–∏ –∏ –ø–æ–¥–∑–∞–¥–∞—á–∏ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–µ—Ä–µ–∑ `parent_id`) |
| `notes` | –°–≤–æ–±–æ–¥–Ω—ã–µ –∏ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ |
| `files` | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ |
| `task_links` | –°–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏ (—Å —Ç–∏–ø–æ–º –∏ –∑–∞—â–∏—Ç–æ–π –æ—Ç —Ü–∏–∫–ª–æ–≤) |
| `note_links` | –î–≤—É–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–º–µ—Ç–∫–∞–º–∏ |
| `event_log` | –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π (–¥–ª—è undo/redo –∏ –∞—É–¥–∏—Ç–∞) |

> –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ–¥–µ—Ä–∂–∞—Ç `canvas_id` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ö–æ–ª—Å—Ç–æ–≤ (–≤ –±—É–¥—É—â–µ–º).

---

### **6. –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤**
- **–¢–∏–ø**: Docker volume (`./data:/data`).
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**:
  ```
  /data/
  ‚îî‚îÄ‚îÄ uploads/
      ‚îî‚îÄ‚îÄ {canvas_id}/
          ‚îú‚îÄ‚îÄ cards/
          ‚îÇ   ‚îî‚îÄ‚îÄ {card_id}/
          ‚îÇ       ‚îú‚îÄ‚îÄ image1.png
          ‚îÇ       ‚îî‚îÄ‚îÄ report.pdf
          ‚îî‚îÄ‚îÄ notes/
              ‚îî‚îÄ‚îÄ {note_id}/
                  ‚îî‚îÄ‚îÄ diagram.svg
  ```
- **–î–æ—Å—Ç—É–ø**: —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ `/api/files/{id}/download` (–±–µ–∑ –ø—Ä—è–º–æ–≥–æ URL).

---

### **7. –ì—Ä–∞—Ñ —Å–≤—è–∑–µ–π (Graph View)**
- **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/graph`.
- **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞**:
  ```json
  {
    "nodes": [
      { "id": "card:1", "type": "task", "label": "–ê–Ω–∞–ª–∏–∑" },
      { "id": "note:5", "type": "note", "label": "–ó–∞–º–µ—Ç–∫–∞" }
    ],
    "edges": [
      { "source": "card:1", "target": "note:5", "type": "attached" },
      { "source": "note:5", "target": "note:7", "type": "linked" }
    ]
  }
  ```
- **–û—Ç—Ä–∏—Å–æ–≤–∫–∞**: Cytoscape.js –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ.

---

## üîÅ **–ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä—ã)**

### **–°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É –∑–∞–¥–∞—á–∞–º–∏**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–µ—Ç –º–∞—Ä–∫–µ—Ä —Å –∑–∞–¥–∞—á–∏ A –Ω–∞ –∑–∞–¥–∞—á—É B.
2. Frontend ‚Üí `POST /api/task-links` —Å `{ source: A, target: B, type: "depends_on" }`.
3. Backend:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–∏–∫–ª —á–µ—Ä–µ–∑ `cycle_detection.check_cycle(A, B)`.
   - –ï—Å–ª–∏ —Ü–∏–∫–ª ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É.
   - –ò–Ω–∞—á–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ `task_links`.
4. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ö–æ–ª—Å—Ç: —Ä–∏—Å—É–µ—Ç —Å—Ç—Ä–µ–ª–∫—É.

### **–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–≤–æ–¥**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç üé§ ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∞—É–¥–∏–æ (WAV).
2. Frontend ‚Üí `POST /voice/transcribe` (—á–µ—Ä–µ–∑ Nginx ‚Üí voice-stt).
3. Vosk –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç.
4. Frontend –≤—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä.

### **–ü–æ–∏—Å–∫**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç ¬´–≥—Ä–∞—Ñ–∏–∫¬ª –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞.
2. Frontend ‚Üí `GET /api/search?q=–≥—Ä–∞—Ñ–∏–∫`.
3. Backend –≤—ã–ø–æ–ª–Ω—è–µ—Ç:
   ```sql
   SELECT * FROM cards WHERE search_vector @@ plainto_tsquery('–≥—Ä–∞—Ñ–∏–∫');
   ```
4. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã ‚Üí frontend –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫.

---

## üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å**
- –í—Å–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤: –ø—Ä–æ–≤–µ—Ä–∫–∞ MIME, —Ä–∞–∑–º–µ—Ä–∞, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
- Path traversal: –∑–∞–ø—Ä–µ—Ç `..` –≤ –ø—É—Ç—è—Ö.
- API: –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (Pydantic).
- –ò—Å—Ç–æ—Ä–∏—è: immutable –ª–æ–≥ (–Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å–∏).
- –ì–æ–ª–æ—Å: –∞—É–¥–∏–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ (–Ω–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤).

---

## üì¶ **Docker-—Å–µ—Ä–≤–∏—Å—ã (docker-compose.yml)**

```yaml
services:
  db:
    image: postgres:15
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init.sql:/docker-entrypoint-initdb.d/init.sql

  backend:
    build: ./backend
    depends_on: [db]
    environment:
      - DATABASE_URL=postgresql://user:pass@db:5432/canvas

  voice-stt:
    build: ./voice-stt
    ports: []  # —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ nginx

  frontend:
    build: ./frontend
    # —Å—Ç–∞—Ç–∏–∫–∞ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ nginx

  nginx:
    build: ./nginx
    ports:
      - "80:80"
    depends_on: [backend, voice-stt]

volumes:
  postgres_data:
  uploads:  # –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ backend –∫–∞–∫ /data
```

---

‚úÖ –≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å.
- **–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –±–ª–æ–∫–æ–≤ –∏–ª–∏ –ò–ò-–º–æ–¥–µ–ª–∏.
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏ –¥–∞–Ω–Ω—ã–º.

–ì–æ—Ç–æ–≤–æ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.